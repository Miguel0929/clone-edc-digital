.container-fluid.container-fixed-lg.bg-white
  .panel.panel-transparent
    .panel-heading
      .pull-right
        .col-xs-12
          /%input#search-table.form-control.pull-right{:placeholder => "Search", :type => "text"}/
          %input#mentor_students.form-control.pull-right{:placeholder => "Search", :type => "text"}/
      .clearfix
    .panel-body
      = bootstrap_form_tag(url: mentor_students_path, method: :get) do |f|
        .row
          .col-md-4
            = f.select :state, options_for_select([['Activo', 'active'], ['Inactivo', 'inactive']], params[:state]), {include_blank: true, label: 'Estado' }
          .col-md-4
            = f.select :group, options_from_collection_for_select(Group.all, :id, :name, params[:group]), {include_blank: true, label: 'Grupo' }
        .row
          .col-md-4
            = f.select :answered, options_for_select(OptionsRange.percentages), {include_blank: true, label: 'Porcentaje contestado' }
          .col-md-4
            = f.select :visited, options_for_select(OptionsRange.percentages), {include_blank: true, label: 'Porcentaje visto' }

        = f.submit 'Filtrar'
        = link_to "Exportar a excel", exports_mentor_students_path(format: :xlsx), class: "btn btn-success"

      .table-responsive
        %table.table.table-hover
          %thead
            %tr
              %th{:width => "3%"}
                Id
              %th{:width => "25%"}
                Datos de contacto
              %th{:width => "20%"}
                Info. de estudiante
              %th{:width => "15%"}
                Avances totales
              %th
                Cursos inscritos          
          %tbody
            - @users.each do |user|
              %tr
                %td
                  = user.id
                %td
                  .m-b-5
                    = link_to user.name, mentor_student_path(user)
                  %ul.p-l-0.m-b-5
                    %li.inline 
                      %i.fa.fa-envelope
                    %li.inline 
                      = user.email
                  %ul.p-l-0.m-b-5
                    %li.inline 
                      %i.fa.fa-phone
                    %li.inline 
                      = user.phone_number
                %td
                  %ul.p-l-0.m-b-5
                    %li.inline 
                      %span.bold Estado:
                    %li.inline 
                      = user.status
                  %ul.p-l-0.m-b-5
                    %li.inline 
                      %span.bold Grupo:
                    %li.inline 
                      = user.group_name.capitalize
                %td
                  - if user.student?
                    %ul.p-l-0.m-b-5
                      %li.inline
                        %span.bold Contestado:
                      %li.inline 
                        #{(user.answers_count * 100) / user.questions_count rescue 0}%
                    %ul.p-l-0.m-b-5
                      %li.inline
                        %span.bold Visto:
                      %li.inline 
                      #{(user.content_tracked_count * 100) / user.content_count rescue 0}%
                    %ul.p-l-0.m-b-5
                      %li.inline
                        %span.bold Comentarios:
                      %li.inline 
                        = user.comments_count
                  %td
                    - unless user.group.nil?
                      %ul.unstyled.no-style
                        - user.group.programs.each do |program|
                          %li.inline.p-b-5
                            %i.fa.fa-check
                            #{program.name}. 
                            %strong
                              Contestado: 
                            #{user.percentage_questions_answered_for(program)}%
                            %strong
                              Visto: 
                            #{user.percentage_content_visited_for(program)}%

      .pull-right
        = paginate @users
        %br
        %span.text-center= page_entries_info @users
