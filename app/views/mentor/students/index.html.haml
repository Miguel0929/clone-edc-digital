.container-fluid.container-fixed-lg.bg-white
  .panel.panel-transparent
    .panel-heading
      .pull-right
        .col-xs-12
          /%input#search-table.form-control.pull-right{:placeholder => "Search", :type => "text"}/
          %input#mentor_students.form-control.pull-right{:placeholder => "Search", :type => "text"}/
      .clearfix
    .panel-body
      = form_tag(mentor_students_path, method: :get) do
        .col-md-12.col-sm-12.col-xs-12
          %aside.sidebar-menu
            %h4.search-title Filtrar búsqueda:
            .search-group
              .col-md-2.col-sm-4.col-xs-12
                .s-s-title
                  %i.fa.fa-check-square-o
                  Status:
                = select_tag :status, options_for_select([['Activo', 'active'], ['Inactivo', 'inactive']], params[:status]), {include_blank: "Filtra por status", class: "form-control"} 
            .search-group
              .col-md-2.col-sm-4.col-xs-12
                .s-s-title
                  %i.fa.fa-users
                  Grupo:
                = select_tag :group, options_from_collection_for_select(Group.all, :id, :name, params[:group]), {include_blank: "Filtra por grupo", class: "form-control" }
            .search-group
              .col-md-2.col-sm-4.col-xs-12
                .s-s-title
                  %i.fa.fa-university
                  Universidad:
                = select_tag :university, options_from_collection_for_select(@universities, :id, :name, params[:university]), {include_blank: "Filtra por universidad", class: "col-md-12" } 
            .search-group
              .col-md-2.col-sm-4.col-xs-12
                .s-s-title
                  %i.fa.fa-map-marker
                  Estado:
                = select_tag :state, options_from_collection_for_select(State.all, :id, :name, params[:state]), {include_blank: "Filtra por estado", class: "col-md-12" }
            .search-group
              .col-md-2.col-sm-4.col-xs-12
                .s-s-title
                  %i.fa.fa-graduation-cap
                  Tipo de grupo:
                = select_tag :tipo,  options_for_select(['Escolarizado', ' Autodidacta digital', 'Presencial', 'Experiemental'], params[:tipo]), {include_blank: "Filtra por tipo de grupo", class: "form-control" }
            .search-group
              .col-md-2.col-sm-4.col-xs-12
                .s-s-title
                  %i.fa.fa-industry
                  Industria:
                = select_tag :industria, options_from_collection_for_select(Industry.all,:id,:name, params[:industria]), {include_blank: "Filtra por industria en la que emprendes", class: "form-control" }
        .col-md-12        
          .search-group
            .col-md-3.col-sm-6.col-xs-12
              .s-s-title
                %i.fa.fa-check-circle
                Porcentaje contestado  
              = select_tag :answered, options_for_select(OptionsRange.percentages, params[:answered]), {include_blank: "Filtra por porcentaje contestado", class: "form-control" }
          .search-group
            .col-md-3.col-sm-6.col-xs-12
              .s-s-title
                %i.fa.fa-eye
                Porcentaje visto
              = select_tag :visited, options_for_select(OptionsRange.percentages, params[:visited]), {include_blank: "Filtra por porcentaje visto", class: "form-control" }
          .search-group
            .col-md-3.col-sm-6.col-xs-12
              .s-s-title
                %i.fa.fa-book
                Programa (*)  
              = select_tag :program, options_from_collection_for_select(Program.all,:id, :name, params[:program]), {include_blank: "Seleccionar programa", class: "form-control" }
        .col-md-12      
          %i.row
            (*) Selecciona un programa para filtrar por el porcentaje de contenido contestado/visto   
        %br
        %br
        .col-md-12
          = submit_tag 'Filtrar', class: "btn btn-default"
          = link_to "Exportar a excel", exports_mentor_students_path(format: :xlsx), class: "btn btn-success"

    .table-responsive
      %table.table.table-hover
        %thead
          %tr
            %th{:width => "3%"}
              Id
            %th{:width => "25%"}
              Datos de contacto
            %th{:width => "20%"}
              Info. de estudiante
            %th{:width => "15%"}
              Avances totales
            %th
              Cursos inscritos          
        %tbody
          - @users.each do |user|
            %tr
              %td
                = user.id
              %td
                .m-b-0
                  = link_to user.name, mentor_student_path(user)
                %ul.p-l-0.m-b-0
                  %li.inline 
                    %i.fa.fa-envelope
                  %li.inline 
                    = user.email
                %ul.p-l-0.m-b-0
                  %li.inline 
                    %i.fa.fa-phone
                  %li.inline 
                    = user.phone_number
                %ul.p-l-0.m-b-0
                  %li.inline 
                    %i.fa.fa-eye
                  %li.inline 
                    = link_to "Ver informacion de usuario", mentor_student_path(user)   
              %td
                %ul.p-l-0.m-b-0
                  %li.inline 
                    %span.bold Estado:
                  %li.inline 
                    = user.status
                %ul.p-l-0.m-b-0
                  %li.inline 
                    %span.bold Grupo:
                  %li.inline 
                    = user.group.name.capitalize
                %ul.p-l-0.m-b-0
                  %li.inline 
                    %span.bold Última sesión:
                  %li.inline 
                    - if !user.visits.last.nil?
                      = l user.visits.last.started_at, format: :short_special
                    - else
                      %span.text-danger Ninguna
              %td
                - if user.student?
                  %ul.p-l-0.m-b-0
                    %li.inline
                      %span.bold Contestado:
                    %li.inline 
                      #{user.answered_questions_percentage rescue 0}%
                  %ul.p-l-0.m-b-0
                    %li.inline
                      %span.bold Visto:
                    %li.inline 
                    #{user.content_visited_percentage rescue 0}%
                  %ul.p-l-0.m-b-0
                    %li.inline
                      %span.bold Status de evaluación:
                    %li.inline 
                    #{user.evaluation_status}
                %td
                  - unless user.group.nil?
                    %ul.unstyled.no-style
                      - user.group.programs.each do |program|
                        %li.inline.p-b-5
                          %i.fa.fa-check
                          #{program.name}. 
                          %strong
                            Contestado: 
                          #{user.percentage_questions_answered_for(program)}%
                          %strong
                            Visto: 
                          #{user.percentage_content_visited_for(program)}%

    .pull-right
      = paginate @users
      %br
      %span.text-center= page_entries_info @users
