- content_for :title  do
  Evaluación de plantillas- EDC Digital

.container-fluid.container-fixed-lg.top-container-padding.minus-30
  %section.demo-bg-section.p-b-15.p-t-15.panel-title-emprendimiento
    .container-fluid
      .md-p-l-20.md-p-r-20.xs-no-padding
        .col-sm-12.col-md-12.xs-p-l-15.xs-p-r-15
          %h2.text-white 
            Evaluacion de plantilla

.container-fluid.container-fixed-lg
  .panel.panel-default
    .panel-heading
      .h3.m-t-20{style: "font-family: 'Segoe UI','Helvetica Neue',Helvetica,Arial,sans-serif;"}= @template_refilable.name
    .panel-body
      %p.m-l-10= @template_refilable.description
      .col-md-5
        - if @refilable.nil?
          .well
            #refilable-content-template
              = raw remove_class(replace_fillable_admin(@template_refilable.content))
        - else
          .well
            #refilable-content-template.nueva-tipografia-rellenable
              = raw remove_class(replace_fillable(@refilable.content)) 
      .col-md-7
        .panel.panel-default
          .panel-heading
            %h3.panel-title Rubricas
          .panel-body
            - if @rubricas.count > 0
              %table.table
                %thead
                  %tr
                    %th Rubrica
                    %th.text-center Evaluacion
                    %th.text-center Puntaje            
                %tbody
                  - total_obtenido = 0; total_puntaje = 0
                  - @rubricas.each do |rubrica|
                    - user_eval = rubrica.user_evaluation_refilables.find_by(user: current_user, refilable_id: @refilable.id)
                    - unless user_eval.nil?
                      - obtenido = user_eval.puntaje
                      - puntaje = rubrica.points
                      - total_obtenido += obtenido
                      - total_puntaje += puntaje 
                      %tr
                        %td.bold
                          =rubrica.name
                        %td
                          - if user_eval.points == 100
                            = rubrica.excelent
                          - elsif user_eval.points == 75
                            = rubrica.good
                          - elsif user_eval.points == 50
                            = rubrica.regular
                          - elsif user_eval.points == 25 
                            = rubrica.bad
                        %td.text-center="#{obtenido} de #{puntaje} pts"                      
                          
                    - else
                      %tr
                        %th=rubrica.name
                        %td{colspan: 2}
                          %center
                            %label.label-danger.padding-5.m-b-10
                              La plantilla no ha sido evaluada
                  %tr
                    %td.bold Totales:
                    %td.bold.text-center=number_to_percentage(user_promedio_refilable(total_obtenido, total_puntaje), precision: 1)  
                    %td.bold.text-center="#{total_obtenido} de #{total_puntaje} pts"               
            - else
              .nav-tabs.nav-tabs-separator.m-b-15
                %label.label-danger.padding-5.m-b-10
                  No hay rúbrica para esta plantilla
          .panel-heading
            %h3.panel-title Comentarios
          .panel-body
            - comentario = @refilable.comments 
            - if comentario.nil?
              %p
                %label.label.label-danger La plantilla aún no ha sido comentada.
            - else
              %p
                = raw comentario                      
- unless @refilable.nil?
  :javascript
    $(document).on('turbolinks:load', function(){
      $('.refilable-edit').removeClass('form-control refilable-input');
      $('.no-answer').text(' (sin respuesta) ');
    });
