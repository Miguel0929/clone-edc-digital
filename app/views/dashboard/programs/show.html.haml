.container-fluid.container-fixed-lg.top-container-padding
  %section.demo-bg-section.p-b-0.p-t-75
    .container
      .md-p-l-20.md-p-r-20.xs-no-padding
        %h5.block-title.hint-text.no-margin.text-white Programa de Aprendizaje
        .pull-right
          -if current_user.admin?
            Rating: 
            = @program.rating
        .row
          .col-sm-5.col-md-4
            %h2.m-t-5.text-white
              = @program.name
          .col-sm-7.col-md-8.no-padding.xs-p-l-15.xs-p-r-15.text-white
            .p-t-20.p-l-35.md-p-l-5.md-p-t-15
              %p
                = @program.description
              %p
                = link_to dashboard_evaluations_path(program_id: @program), class: 'btn btn-sm btn-primary btn-cons m-b-10' do
                  %i.fa.fa-play
                  %span.bold Ir a mi rúbrica de evaluación
                = link_to dashboard_program_path(user_id: current_user, format: :xlsx), class: "btn btn-success btn-sm btn-cons m-b-10" do
                  %i.fa.fa-file-excel-o
                  Descargar mi compilación de resultados en Excel
        -if @current_user.percentage_questions_answered_for(@program) == 0
          %section.demo-bg-section.p-b-20.p-t-65
            .pull-right.m-r-60
              %h5{:style => "color: #48B0F7;"}
                No has iniciado este programa aún
            .clearfix
        -elsif
          %section.demo-bg-section.p-b-10.p-t-65
            .progress.m-b-5{:style => "background-color: #ffffff1a;"}
              .progress-bar.progress-bar-complete{:style => "width:#{@current_user.percentage_questions_answered_for(@program)}%"}
            .pull-right.m-r-50{:style => "color: #48B0F7;"}
              Progreso contestado del #{@current_user.percentage_questions_answered_for(@program)}%
            .clearfix
              .pull-right    
                Calificar curso:
                = render partial: "layouts/stars", locals: {value: @program, route: ratings_vote_program_path}   

.container-fluid.container-fixed-lg
  .row
    .col-sm-12
      .panel.panel-transparent
        .panel-heading
          .panel-title
            Detalles del contenido
        .panel-body
          - @program.chapters.each do |chapter|
            .sm-m-l-5.sm-m-r-5
              #accordion.panel-group{"aria-multiselectable" => "true", :role => "tablist"}
                .panel.panel-default
                  .panel-heading{:role => "tab", :id=>"heading_#{chapter.id}"}
                    %h4.panel-title
                      %a{"aria-controls" => "collapse_#{chapter.id}", "aria-expanded" => "false", "data-parent" => "#accordion", "data-toggle" => "collapse", :href => "#collapse_#{chapter.id}"}
                        = "#{chapter.name} (#{chapter.points} puntos)"

                  .panel-collapse.collapse{:id=>"collapse_#{chapter.id}", "aria-labelledby" => "heading_#{chapter.id}", :role => "tabpanel"}
                    .panel-body
                      %table.table.table-striped.table-top-border
                        %tbody
                          - chapter.chapter_contents.each do |content|
                            %tr.odd.gradeX
                              %td{style: "width: 5%;"}
                                = link_to dashboard_chapter_content_path(content), class: "btn #{current_user.trackers.find_by(chapter_content: content).nil? ? 'btn-default' : 'btn-success'} btn-rounded redirector" do
                                  - if content.coursable_type == 'Lesson'
                                    %i.fa.fa-youtube-play
                                  - elsif content.coursable_type == 'Question'
                                    %i.fa.fa-tasks

                              %td{style: "width: 60%;"}
                                - if content.coursable_type == 'Lesson'
                                  = content.model.identifier
                                - elsif content.coursable_type == 'Question'
                                  = content.model.question_text
                              %td
                                - if content.coursable_type == 'Lesson'
                                  %span.label{class: "#{current_user.trackers.find_by(chapter_content: content).nil? ? '' : 'label-success'}"}
                                    = current_user.trackers.find_by(chapter_content: content).nil? ? 'Nuevo' : 'Completado'
                                - elsif content.coursable_type == 'Question'
                                  %span.label{class: "#{current_user.has_answer_question?(content.model) ? 'label-success' : ''}"}
                                    = current_user.has_answer_question?(content.model) ? 'Completado' : 'Nuevo'

                              %td
                                - if content.coursable_type == 'Question'
                                  Comentarios
                                  %span.badge
                                    = content.model.comments_for(current_user)
:javascript
  var frm = $('#form_rank');
  $('.rank').click(function() {
    frm.submit();
  });
  frm.submit(function (ev) {
    console.log(9);
    $.ajax({
        type: frm.attr('method'),
        url: frm.attr('action'),
        data: frm.serialize(),
        success: function (data) {
          console.log(data);
        },
        error: function (data){
        }
    });
    ev.preventDefault();
  });
