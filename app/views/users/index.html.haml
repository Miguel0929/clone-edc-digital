.container-fluid.container-fixed-lg.bg-white
  .panel.panel-transparent
    .panel-heading
      .pull-right
        .col-xs-12
          %input#search-table.form-control.pull-right{:placeholder => "Search", :type => "text"}/
      .clearfix
    .panel-body
      - if current_user.admin?
        = bootstrap_form_tag(url: users_path, method: :get) do |f|
          .row
            .col-md-4
              = f.select :state, options_for_select([['Activo', 'active'], ['Inactivo', 'inactive']], params[:state]), {include_blank: true, label: 'Estado' }
            .col-md-4
              = f.select :group, options_from_collection_for_select(Group.all, :id, :name, params[:group]), {include_blank: true, label: 'Grupo' }

          = f.submit 'Filtrar'
          = link_to "Exportar Excel", users_path(format: :xls, state: params[:state], group: params[:group]), { target: '_blank', class: 'btn btn-default'}

      %table.table.table-hover.datatable
        %thead
          %tr
            %th
              Id
            %th
              Nombre
            %th
              Correo electrónico
            %th
              Teléfono
            %th
              Estado
            %th
              Rol
            %th
              Grupo
            %th
              Porcentaje contestado
            %th
              Porcentaje de avance
            %th
              Total de comentarios
            %th
              Cursos inscritos
            %th
        %tbody
          - @users.each do |user|
            %tr
              %td
                = user.id
              %td
                = link_to user.name, user_path(user)
              %td
                = user.email
              %td
                = user.phone_number
              %td
                = user.status
              %td
                = user.huminize_role
              %td
                = user.group_name
              %td
                #{(user.answers_count * 100) / user.questions_count rescue 0}%
              %td
                #{(user.content_tracked_count * 100) / user.content_count rescue 0}%
              %td
                = user.comments_count
              %td
                - unless user.group.nil?
                  - user.group.programs.each do |program|
                    %p
                      #{program.name} (#{user.percentage_content_visited_for(program)}% visto / #{user.percentage_questions_answered_for(program)}% contestado)
              %td
                .btn-group
                  %button.btn.btn-default.dropdown-toggle{"aria-expanded" => "false", "aria-haspopup" => "true", "data-toggle" => "dropdown", :type => "button"}
                    %span.glyphicon.glyphicon-pencil
                    %span.caret
                  %ul.dropdown-menu
                    %li
                      = link_to 'Ver información', user_path(user)
                    - if user.student?
                      %li
                        = link_to 'Editar información', edit_user_path(user)
                    %li.divider
                    %li
                      = link_to 'Eliminar usuario', user_path(user), method: :delete, data: { confirm: '¿Estás seguro?' }


      = link_to 'Invitar usuario', new_user_invitation_path, class: 'btn btn-default'
